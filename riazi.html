<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>ریاضی</title>
<style>

/* گالری: تصاویر واکنش‌گرا */
#galStrip img{
max-height: 68vh;
width: auto;
border-radius: 12px;
border: 1px solid rgba(255,255,255,.2);
box-shadow: 0 10px 26px rgba(0,0,0,.4);
display:block;
}
#galStrip {
display:flex;
flex-direction:column; /* عکس‌ها زیر هم */
gap:10px; /* فاصله عمودی بین عکس‌ها */
overflow-y:auto; /* اسکرول عمودی */
max-height:70vh; /* ارتفاع محدود تا صفحه نسوزه */
scroll-behavior:smooth;
padding:6px;
}


@font-face{
font-family:'iranyekanX';
src:url('IRANYekanX-Light.woff2') format('woff2');
}
*{box-sizing:border-box}
body {
font-family: 'iranyekanX', sans-serif;
margin: 0;
padding: 0;
color: #fff;
background:
radial-gradient(circle at 15% 25%, #f1bab2, transparent 40%), /* مرجانی */
radial-gradient(circle at 85% 25%, #fcd34d, transparent 45%), /* زرد روشن */
radial-gradient(circle at 50% 80%, #84fab0, transparent 40%), /* سبز نعنایی */
linear-gradient(180deg, #fcbdb3 0%, #84fab0 100%);
background-attachment: fixed;
min-height: 100vh;
position: relative;
}
body::before{content:"";position:fixed;inset:0;background:linear-gradient(to bottom,rgba(0,0,0,.15),rgba(0,0,0,.25));pointer-events:none;z-index:0}
header{
text-align:center;font-weight:800;margin:26px 0 10px;font-size:38px;
background:linear-gradient(90deg,#60a5fa,#a78bfa,#34d399,#fbbf24,#f87171);
background-size:400% 400%;
-webkit-background-clip:text;-webkit-text-fill-color:transparent;
animation:headGrad 18s ease infinite;text-shadow:0 0 10px rgba(255,255,255,.25);position:relative;z-index:1
}
@keyframes headGrad{0%{background-position:0% 50%}50%{background-position:100% 50%}100%{background-position:0% 50%}}

/* toolbar */
.toolbar{width:min(920px,95%);margin:0 auto 8px;display:flex;gap:10px;justify-content:space-between;align-items:center;z-index:2;position:relative}
.search-box{flex:1;position:relative}
.search-input{
width:100%;border:none;border-radius:12px;padding:12px 40px 12px 36px;
background:rgba(255,255,255,.14);color:#fff;font-family:inherit;outline:none;
box-shadow:0 8px 18px rgba(0,0,0,.28);border:1px solid rgba(255,255,255,.15)
}
.search-input::placeholder{color:#FFFFFF}
.search-clear{
position:absolute;left:10px;top:50%;transform:translateY(-50%);
width:22px;height:22px;border-radius:50%;background:rgba(255,255,255,.2);
display:none;align-items:center;justify-content:center;cursor:pointer;color:#fff;
box-shadow:0 4px 10px rgba(0,0,0,.3);font-weight:900
}
.search-icon{position:absolute;right:10px;top:50%;transform:translateY(-50%);opacity:.9}
.sort-btn{
border:none;border-radius:12px;padding:12px 16px;cursor:pointer;color:#fff;
background:linear-gradient(135deg,#1C93E3,#2ea3f2);
box-shadow:0 8px 18px rgba(28,147,227,.4);
font-family:inherit;
}

.panel{
width:min(920px,95%);margin:12px auto 20px;padding:22px 20px 26px;background:rgba(255,255,255,.12);
border:1px solid rgba(255,255,255,.2);border-radius:18px;box-shadow:0 10px 25px rgba(0,0,0,.35);
backdrop-filter:blur(6px);position:relative;z-index:1
}
.panel h2{margin:0 0 18px;font-size:22px;color:#f1f5f9;text-shadow:0 2px 8px rgba(0,0,0,.4)}
ul.books{list-style:none;margin:0;padding:0}
li{margin:10px 0}

/* کارت کتاب – گرید با ستون آیکون‌ها سمت چپ */
.book-card{
display:grid; grid-template-columns:134px 1fr; align-items:center;
direction:ltr; gap:10px;text-decoration:none;color:#fff;
background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.15);padding:14px;border-radius:12px;
box-shadow:0 6px 18px rgba(0,0,0,.28);transition:transform .18s ease,box-shadow .18s ease,background .18s ease;position:relative; cursor:pointer;
}
.book-card:hover{transform:translateY(-3px);background:rgba(255,255,255,.16);box-shadow:0 12px 28px rgba(0,0,0,.45)}
.title{font-size:16.5px;line-height:1.6;white-space:normal;word-wrap:break-word;text-shadow:0 2px 6px rgba(0,0,0,.45);direction:rtl}
.dcount{font-size:13px;opacity:.9}

.left-acts{
display:grid; grid-template-columns:46px 46px;
grid-template-rows:38px 14px 38px 14px 38px 14px;
gap:6px 10px; align-items:center; justify-items:center; min-width:134px;
}
.left-acts .icon-wrap{
width:38px;height:38px;display:flex;align-items:center;justify-content:center;cursor:pointer;
border-radius:10px;background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.18);
box-shadow:0 6px 16px rgba(0,0,0,.35); transition:transform .15s ease, background .15s ease
}
.left-acts .icon-wrap:hover{ transform:translateY(-2px); background:rgba(255,255,255,.16) }
.left-acts svg{ width:22px;height:22px; fill:#fff; filter: drop-shadow(0 2px 4px rgba(0,0,0,.45));}
.under-txt{font-size:11.5px;color:#eaeaea;direction:rtl}

.dl{grid-column:1;grid-row:1}
.star{grid-column:2;grid-row:1}
.size-label{grid-column:1;grid-row:2}
.rate-label{grid-column:2;grid-row:2}
.share{grid-column:1;grid-row:3}
.buy{grid-column:2;grid-row:3}
.share-label{grid-column:1;grid-row:4}
.comment{grid-column:2;grid-row:5}
.cmt-label{grid-column:2;grid-row:6}

.star-tip{
position:absolute; right:134px; bottom:10px; background:rgba(0,0,0,.65);
border:1px solid rgba(255,255,255,.15); color:#fff; font-size:12.5px; padding:6px 10px; border-radius:10px;
box-shadow:0 10px 25px rgba(0,0,0,.35);
opacity:0; transform:translateY(12px); pointer-events:none; transition:all .35s ease;
max-width: 68%; line-height:1.8; direction:rtl
}
.star-tip.show{ opacity:1; transform:translateY(0) }
.star-tip.hide{ opacity:0; transform:translateY(18px) }

.btn-back{
display:inline-block;margin:24px auto 10px;background:linear-gradient(135deg,#1C93E3,#2ea3f2);padding:12px 26px;color:#fff;text-decoration:none;border-radius:12px;box-shadow:0 8px 18px rgba(28,147,227,.4);transition:transform .15s ease, box-shadow .15s ease
}
.btn-back:hover{transform:translateY(-2px);box-shadow:0 12px 26px rgba(28,147,227,.6)}
#counter{text-align:center;margin:12px 0 24px;font-size:15px;color:#eaeaea;text-shadow:0 2px 6px rgba(0,0,0,.45)}

/* مودال‌ها */
.modal{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.5); z-index:50 }
.modal .box{
width:min(680px,92%); border-radius:16px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.2);
box-shadow:0 18px 40px rgba(0,0,0,.45); padding:14px 16px; backdrop-filter:blur(6px); color:#fff; position:relative; transform:scale(.95); opacity:0; transition: all .25s ease; direction:rtl
}
.modal.show .box{ transform:scale(1); opacity:1; }
.modal h3{ margin:6px 0 12px; font-size:18px }
.modal .row{ display:flex; gap:8px; justify-content:flex-end; align-items:center; margin-top:8px; flex-wrap:wrap }
.btn{ border:none; border-radius:10px; padding:8px 16px; cursor:pointer; color:#fff; box-shadow:0 6px 16px rgba(0,0,0,.35); background:linear-gradient(135deg,#34d399,#10b981); font-family:inherit }
.btn.gray{ background:linear-gradient(135deg,#64748b,#475569) }

.modal-sort{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.5); z-index:60; }
.modal-sort .box{
width:min(520px,92%); border-radius:16px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.2);
box-shadow:0 18px 40px rgba(0,0,0,.45); padding:14px 16px; backdrop-filter:blur(6px); color:#fff; position:relative; transform:scale(.94); opacity:0; transition: all .2s ease; direction:rtl
}
.modal-sort.show .box{ transform:scale(1); opacity:1; }
.sort-title{ font-size:16px; margin-bottom:10px }
.sort-list{ list-style:none; margin:0; padding:0 }
.sort-list li{
margin:8px 0; padding:10px 12px; border-radius:10px; background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.15);
cursor:pointer; transition: all .15s ease;
}
.sort-list li:hover{ background: rgba(255,255,255,.16) }
.sort-list li.active{ background: linear-gradient(135deg,#34d399,#10b981) }
.modal-sort .row{ display:flex; gap:8px; justify-content:flex-end; margin-top:10px }

.modal-cmt{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(0,0,0,.55); z-index:70; }
.modal-cmt .box{
width:min(720px,92%); border-radius:16px; background:rgba(255,255,255,.12); border:1px solid rgba(255,255,255,.2);
box-shadow:0 18px 40px rgba(0,0,0,.45); padding:14px 16px; backdrop-filter:blur(6px); color:#fff; position:relative; transform:translateY(20px); opacity:0; transition: all .25s ease; direction:rtl
}
.modal-cmt.show .box{ transform:translateY(0); opacity:1; }
.cmt-list{ list-style:none; margin:6px 0 10px; padding:0; max-height:280px; overflow-y:auto }
.cmt-item{ background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.15); padding:8px 10px; border-radius:10px; margin:8px 0 }
.cmt-head{ display:flex; align-items:center; justify-content:space-between; font-size:12px; color:#e7e7e7; margin-bottom:4px }
.cmt-text{ font-size:14.5px; line-height:1.8; white-space:pre-wrap }
.cmt-input{ width:100%; min-height:70px; border-radius:10px; border:none; padding:10px; resize:vertical; font-family:inherit }
.cmt-foot{ display:flex; gap:8px; justify-content:flex-end; margin-top:8px }
.cmt-rule{ font-size:12px; opacity:.85; margin-top:6px; text-align:center }
.cmt-name{ width:100%; border-radius:10px; border:none; padding:10px; margin:8px 0; font-family:inherit }

/* قلب */
.left-acts .fav{ grid-column:1; grid-row:5; }
.left-acts .fav-label{ grid-column:1; grid-row:6; }
.icon-wrap.fav .heart-filled{ display:none }
.icon-wrap.fav.active .heart-filled{ display:block }
.icon-wrap.fav.active .heart-outline{ display:none }

/* فیلتر برچسب (چیپ) */
#tagsModal .box, #tagsModal .sort-title, #tagsModal .tag-group-title, #tagsModal .chip {
font-family: 'IRANYekanX-Light','IRANYekanX','iranyekan','IranYekan','Tahoma',sans-serif !important;
}
.tags-container{ display:block }
.tag-group{ margin:10px 0 12px }
.tag-group-title{ font-weight:800; opacity:.95; margin:6px 0 }
.tag-group-body{ display:flex; flex-wrap:wrap; gap:8px }
.chip{
display:inline-flex; align-items:center; gap:6px;
padding:6px 12px; border-radius:999px; cursor:pointer;
background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.15);
transition: transform .12s ease, background .12s ease, border-color .12s ease, box-shadow .12s ease;
user-select:none; font-size:14px; line-height:1; color:inherit;
}
.chip:active{ transform:scale(.98) }
.chip.active{
background:linear-gradient(135deg,#34d399,#10b981);
border-color:transparent; color:#fff;
box-shadow:0 6px 16px rgba(0,0,0,.25);
}
.btn-danger{ background:rgba(239,68,68,.12); border:1px solid rgba(239,68,68,.7); color:#fecaca }
.btn-danger:hover{ filter:brightness(1.05) }

/* کارت‌هایی که فقط آیکن View دارند */
.book-card.view-only{
grid-template-columns: 56px 1fr !important; /* ستون آیکن باریک */
}

/* ستون آیکن‌ها در حالت view-only */
.book-card.view-only .left-acts{
grid-template-columns: 46px !important; /* فقط یک ستون برای یک آیکن */
grid-template-rows: 38px !important;
gap: 0 !important;
min-width: auto !important; /* دیگه 134px نباشه */
justify-items: center;
}

/* خود آیکن */
.book-card.view-only .left-acts .icon-wrap{
width: 38px; height: 38px;
}

/* هرچی به جز آیکن View هست پنهان کن */
.book-card.view-only .left-acts > :not(.view){
display: none !important;
}

/* جای تولتیپ ستاره اگه موندی به کارش: نزدیک ستون باریک */
.book-card.view-only .star-tip{
right: 56px !important;
}

</style>
</head>
<script>
  window.API_BASE = "https://hidden-forest-5a81.mohamadgpt19.workers.dev";
</script>
<body>
<header>ریاضی 📘</header>

<div class="toolbar">
<div class="search-box">
<input id="searchInput" class="search-input" type="text" placeholder="جست‌وجو بین کتاب‌ها"/>
<span class="search-icon">🔎</span>
<span id="searchClear" class="search-clear">×</span>
</div>
<button id="btnSort" class="sort-btn">مرتب‌سازی: پیش‌فرض</button>
<button id="btnTags" class="sort-btn">برچسب</button>
</div>


<!-- === پنل جامع === -->
<section class="panel" data-panel="jame">
<h2>کتاب‌های جامع ریاضی</h2>
<ul class="books" id="listJame">

<li data-id="riazi10,11,12-jambakdi">
<div class="book-card" data-href="https://s32.picofile.com/d/8481776942/0ddd8828-1dda-46ff-b707-281f30e7a951/مهر_و_ماه.pdf">
<div class="left-acts">
<div class="icon-wrap dl" title="دانلود"><svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM11 4h2v8h3l-4 4-4-4h3V4z"/></svg></div>
<div class="icon-wrap star" title="امتیاز"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.86L18.18 22 12 18.56 5.82 22 7 14.13 2 9.27l6.91-1.01L12 2z"/></svg></div>
<div class="under-txt size-label" data-size>53 MB</div>
<div class="under-txt rate-label" data-rate>؟</div>
<div class="icon-wrap share" title="اشتراک‌گذاری"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.28 3.28 0 0 0 0-1.39l7.13-4.12A2.99 2.99 0 0 0 18 7a3 3 0 1 0-3-3c0 .23.03.45.08.66L7.91 9.77A3 3 0 0 0 6 9a3 3 0 1 0 0 6c.73 0 1.4-.26 1.91-.69l7.21 4.2c-.05.2-.08.41-.08.63A3 3 0 1 0 18 16.08z"/></svg></div>
<div class="icon-wrap buy" title="خرید"><svg viewBox="0 0 24 24"><path d="M7 4H5l-1 2H0v2h2l3.6 7.59c-.35.6-.6 1.28-.6 2.01A3.5 3.5 0 0 0 8.5 21 3.5 3.5 0 0 0 12 18.5h2A3.5 3.5 0 0 0 17.5 21 3.5 3.5 0 0 0 21 17.5c0-1.23-.66-2.29-1.64-2.86L21 7H7V4zm0 4h12l-1.5 6.5H9L7 8z"/></svg></div>
<div class="under-txt share-label"></div>
<div class="icon-wrap comment" title="کامنت‌ها"><svg viewBox="0 0 24 24"><path d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/></svg></div>
<div class="under-txt cmt-label" data-cmtcount>۰</div>
<div class="icon-wrap fav" title="علاقه‌مندی">
<svg class="heart-outline" viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.9 7.1 7 5.5 8.6a4.3 4.3 0 0 0 0 6.1L12 21l6.5-6.3a4.3 4.3 0 0 0 0-6.1c-1.6-1.6-4.6-1.7-6.4.04z" fill="none" stroke="white" stroke-width="1.6"/></svg>
<svg class="heart-filled" viewBox="0 0 24 24"><path d="M12.1 21.35l-1.1-1.01C5.14 15.28 2 12.36 2 8.99 2 6.42 4.42 4 7 4c1.54 0 3.04.73 4 1.87C11.96 4.73 13.46 4 15 4c2.58 0 5 2.42 5 4.99 0 3.37-3.14 6.29-8.9 11.35z"/></svg>
</div>
<div class="under-txt fav-label" data-favcount>۰</div>
</div>
<span class="title">جمع‌بندی – مهر و ماه <span class="dcount" data-dlc>(۰ دانلود)</span></span>
<div class="star-tip"></div>
</div>
</li>

</ul>
</section>

<!-- === پنل پایه دوازدهم === -->
<section class="panel" data-panel="12">
  <h2>کتاب‌های ریاضی، پایه دوازدهم</h2>
  <ul class="books" id="list12">
  ان شاء الله پی دی اف های این پایه بعد از اتمام سال تحصیلی یازدهم بارگزاری میشه
    <li data-id="riazi12-videos">
      <div class="book-card view-only" data-video="riazi12">
        <div class="left-acts">
          <div class="icon-wrap view" title="نمایش">
            <svg viewBox="0 0 24 24">
              <path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-8a3 3 0 1 0 .001 6.001A3 3 0 0 0 12 9z"/>
            </svg>
          </div>
        </div>
        <span class="title">فیلم‌های آموزشی ریاضی دوازدهم - آموزش آباد</span>
      </div>
    </li>
    
  
  </ul>
  </section>

  

<!-- === پنل پایه یازدهم ریاضی === -->
<section class="panel" data-panel="11">
<h2>کتاب‌های ریاضی، پایه یازدهم</h2>

<ul class="books" id="list11">

  <!-- فیلم‌های آموزشی پایه یازدهم -->
<li data-id="riazi11-videos">
  <div class="book-card view-only" data-video="riazi11">
    <div class="left-acts">
      <!-- آیکن View -->
      <div class="icon-wrap view" title="نمایش">
        <svg viewBox="0 0 24 24">
          <path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-8a3 3 0 1 0 .001 6.001A3 3 0 0 0 12 9z"/>
        </svg>
      </div>
    </div>
    <span class="title">فیلم‌های آموزشی ریاضی یازدهم - آموزش آباد</span>
  </div>
</li>


  
<!-- کتاب: شب امتحان یازدهم -->
<li data-id="riazi-shab">
<div class="book-card" data-href="https://mega.nz/file/MuARgLSR#sgLuKwZW4m6c6df7kD-4tPamm0tMhF5P_Qeyim9YfV0">
<div class="left-acts">
<div class="icon-wrap dl" title="دانلود"><svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM11 4h2v8h3l-4 4-4-4h3V4z"/></svg></div>
<div class="icon-wrap star" title="امتیاز"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.86L18.18 22 12 18.56 5.82 22 7 14.13 2 9.27l6.91-1.01L12 2z"/></svg></div>
<div class="under-txt size-label" data-size>20 MB</div>
<div class="under-txt rate-label" data-rate>4.5</div>
<div class="icon-wrap share" title="اشتراک‌گذاری"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.28 3.28 0 0 0 0-1.39l7.13-4.12A2.99 2.99 0 0 0 18 7a3 3 0 1 0-3-3c0 .23.03.45.08.66L7.91 9.77A3 3 0 0 0 6 9a3 3 0 1 0 0 6c.73 0 1.4-.26 1.91-.69l7.21 4.2c-.05.2-.08.41-.08.63A3 3 0 1 0 18 16.08z"/></svg></div>
<div class="icon-wrap buy" title="خرید"><svg viewBox="0 0 24 24"><path d="M7 4H5l-1 2H0v2h2l3.6 7.59c-.35.6-.6 1.28-.6 2.01A3.5 3.5 0 0 0 8.5 21 3.5 3.5 0 0 0 12 18.5h2A3.5 3.5 0 0 0 17.5 21 3.5 3.5 0 0 0 21 17.5c0-1.23-.66-2.29-1.64-2.86L21 7H7V4zm0 4h12l-1.5 6.5H9L7 8z"/></svg></div>
<div class="under-txt share-label"></div>
<div class="icon-wrap comment" title="کامنت‌ها"><svg viewBox="0 0 24 24"><path d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/></svg></div>
<div class="under-txt cmt-label" data-cmtcount>۰</div>
<div class="icon-wrap fav" title="علاقه‌مندی">
<svg class="heart-outline" viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.9 7.1 7 5.5 8.6a4.3 4.3 0 0 0 0 6.1L12 21l6.5-6.3a4.3 4.3 0 0 0 0-6.1c-1.6-1.6-4.6-1.7-6.4.04z" fill="none" stroke="white" stroke-width="1.6"/></svg>
<svg class="heart-filled" viewBox="0 0 24 24"><path d="M12.1 21.35l-1.1-1.01C5.14 15.28 2 12.36 2 8.99 2 6.42 4.42 4 7 4c1.54 0 3.04.73 4 1.87C11.96 4.73 13.46 4 15 4c2.58 0 5 2.42 5 4.99 0 3.37-3.14 6.29-8.9 11.35z"/></svg>
</div>
<div class="under-txt fav-label" data-favcount>۰</div>
</div>
<span class="title">شب امتحان – خیلی‌سبز <span class="dcount" data-dlc>(۰ دانلود)</span></span>
<div class="star-tip"></div>
</div>
</li>

<!-- جزوه همه فصل‌ها یازدهم -->
<li data-id="riazi11-AllFasl">
<div class="book-card" data-href="https://s34.picofile.com/d/8486791500/4a6b0c74-2266-46e1-b5e9-49df2e6f36d7/riazi11_AllFasls.pdf">
<div class="left-acts">
<div class="icon-wrap dl" title="دانلود"><svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM11 4h2v8h3l-4 4-4-4h3V4z"/></svg></div>
<div class="icon-wrap star" title="امتیاز"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.86L18.18 22 12 18.56 5.82 22 7 14.13 2 9.27l6.91-1.01L12 2z"/></svg></div>
<div class="under-txt size-label" data-size>5 MB</div>
<div class="under-txt rate-label" data-rate>؟</div>
<div class="icon-wrap share" title="اشتراک‌گذاری"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.28 3.28 0 0 0 0-1.39l7.13-4.12A2.99 2.99 0 0 0 18 7a3 3 0 1 0-3-3c0 .23.03.45.08.66L7.91 9.77A3 3 0 0 0 6 9a3 3 0 1 0 0 6c.73 0 1.4-.26 1.91-.69l7.21 4.2c-.05.2-.08.41-.08.63A3 3 0 1 0 18 16.08z"/></svg></div>
<div class="icon-wrap buy" title="خرید"><svg viewBox="0 0 24 24"><path d="M7 4H5l-1 2H0v2h2l3.6 7.59c-.35.6-.6 1.28-.6 2.01A3.5 3.5 0 0 0 8.5 21 3.5 3.5 0 0 0 12 18.5h2A3.5 3.5 0 0 0 17.5 21 3.5 3.5 0 0 0 21 17.5c0-1.23-.66-2.29-1.64-2.86L21 7H7V4zm0 4h12l-1.5 6.5H9L7 8z"/></svg></div>
<div class="under-txt share-label"></div>
<div class="icon-wrap comment" title="کامنت‌ها"><svg viewBox="0 0 24 24"><path d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/></svg></div>
<div class="under-txt cmt-label" data-cmtcount>۰</div>
<div class="icon-wrap fav" title="علاقه‌مندی">
<svg class="heart-outline" viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.9 7.1 7 5.5 8.6a4.3 4.3 0 0 0 0 6.1L12 21l6.5-6.3a4.3 4.3 0 0 0 0-6.1c-1.6-1.6-4.6-1.7-6.4.04z" fill="none" stroke="white" stroke-width="1.6"/></svg>
<svg class="heart-filled" viewBox="0 0 24 24"><path d="M12.1 21.35l-1.1-1.01C5.14 15.28 2 12.36 2 8.99 2 6.42 4.42 4 7 4c1.54 0 3.04.73 4 1.87C11.96 4.73 13.46 4 15 4c2.58 0 5 2.42 5 4.99 0 3.37-3.14 6.29-8.9 11.35z"/></svg>
</div>
<div class="under-txt fav-label" data-favcount>۰</div>
</div>
<span class="title">جزوه همه فصل‌ها – ریاضی با محسنی <span class="dcount" data-dlc>(۰ دانلود)</span></span>
<div class="star-tip"></div>
</div>
</li>





</ul>
</section>

<!-- === پنل پایه دهم ریاضی === -->
<section class="panel" data-panel="10">
<h2>کتاب‌های ریاضی، پایه دهم</h2>


  
<ul class="books" id="list10">

  <li data-id="riazi10-videos">
    <div class="book-card view-only" data-video="riazi10">
      <div class="left-acts">
        <!-- آیکن View -->
        <div class="icon-wrap view" title="نمایش">
          <svg viewBox="0 0 24 24">
            <path d="M12 5C7 5 2.73 8.11 1 12c1.73 3.89 6 7 11 7s9.27-3.11 11-7c-1.73-3.89-6-7-11-7zm0 12a5 5 0 1 1 0-10 5 5 0 0 1 0 10zm0-8a3 3 0 1 0 .001 6.001A3 3 0 0 0 12 9z"/>
          </svg>
        </div>
      </div>
      <span class="title">فیلم‌های آموزشی ریاضی دهم - آموزش آباد</span>
    </div>
  </li>
    
<!-- کتاب: شب امتحان دهم -->
<li data-id="riazi10-shab">
<div class="book-card" data-href="https://s32.picofile.com/d/8481776968/b073251c-8bdf-4d4b-b0ac-3e4e30145283/شب_امتحان.pdf">
<div class="left-acts">
<div class="icon-wrap dl" title="دانلود"><svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM11 4h2v8h3l-4 4-4-4h3V4z"/></svg></div>
<div class="icon-wrap star" title="امتیاز"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.86L18.18 22 12 18.56 5.82 22 7 14.13 2 9.27l6.91-1.01L12 2z"/></svg></div>
<div class="under-txt size-label" data-size>21 MB</div>
<div class="under-txt rate-label" data-rate>4.5</div>
<div class="icon-wrap share" title="اشتراک‌گذاری"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.28 3.28 0 0 0 0-1.39l7.13-4.12A2.99 2.99 0 0 0 18 7a3 3 0 1 0-3-3c0 .23.03.45.08.66L7.91 9.77A3 3 0 0 0 6 9a3 3 0 1 0 0 6c.73 0 1.4-.26 1.91-.69l7.21 4.2c-.05.2-.08.41-.08.63A3 3 0 1 0 18 16.08z"/></svg></div>
<div class="icon-wrap buy" title="خرید"><svg viewBox="0 0 24 24"><path d="M7 4H5l-1 2H0v2h2l3.6 7.59c-.35.6-.6 1.28-.6 2.01A3.5 3.5 0 0 0 8.5 21 3.5 3.5 0 0 0 12 18.5h2A3.5 3.5 0 0 0 17.5 21 3.5 3.5 0 0 0 21 17.5c0-1.23-.66-2.29-1.64-2.86L21 7H7V4zm0 4h12l-1.5 6.5H9L7 8z"/></svg></div>
<div class="under-txt share-label"></div>
<div class="icon-wrap comment" title="کامنت‌ها"><svg viewBox="0 0 24 24"><path d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/></svg></div>
<div class="under-txt cmt-label" data-cmtcount>۰</div>
<div class="icon-wrap fav" title="علاقه‌مندی">
<svg class="heart-outline" viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.9 7.1 7 5.5 8.6a4.3 4.3 0 0 0 0 6.1L12 21l6.5-6.3a4.3 4.3 0 0 0 0-6.1c-1.6-1.6-4.6-1.7-6.4.04z" fill="none" stroke="white" stroke-width="1.6"/></svg>
<svg class="heart-filled" viewBox="0 0 24 24"><path d="M12.1 21.35l-1.1-1.01C5.14 15.28 2 12.36 2 8.99 2 6.42 4.42 4 7 4c1.54 0 3.04.73 4 1.87C11.96 4.73 13.46 4 15 4c2.58 0 5 2.42 5 4.99 0 3.37-3.14 6.29-8.9 11.35z"/></svg>
</div>
<div class="under-txt fav-label" data-favcount>۰</div>
</div>
<span class="title">شب امتحان – خیلی‌سبز <span class="dcount" data-dlc>(۰ دانلود)</span></span>
<div class="star-tip"></div>
</div>
</li>

<!-- کتاب: ماجراهای من و درسام دهم -->
<li data-id="riazi10-majaraha">
<div class="book-card" data-href="https://s32.picofile.com/d/8481776950/ae08d84f-3f18-4d21-9369-1a080759a309/ماجراهای_من_و_دسام_ریاضی.pdf">
<div class="left-acts">
<div class="icon-wrap dl" title="دانلود"><svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM11 4h2v8h3l-4 4-4-4h3V4z"/></svg></div>
<div class="icon-wrap star" title="امتیاز"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.86L18.18 22 12 18.56 5.82 22 7 14.13 2 9.27l6.91-1.01L12 2z"/></svg></div>
<div class="under-txt size-label" data-size>54 MB</div>
<div class="under-txt rate-label" data-rate>4.3</div>
<div class="icon-wrap share" title="اشتراک‌گذاری"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.28 3.28 0 0 0 0-1.39l7.13-4.12A2.99 2.99 0 0 0 18 7a3 3 0 1 0-3-3c0 .23.03.45.08.66L7.91 9.77A3 3 0 0 0 6 9a3 3 0 1 0 0 6c.73 0 1.4-.26 1.91-.69l7.21 4.2c-.05.2-.08.41-.08.63A3 3 0 1 0 18 16.08z"/></svg></div>
<div class="icon-wrap buy" title="خرید"><svg viewBox="0 0 24 24"><path d="M7 4H5l-1 2H0v2h2l3.6 7.59c-.35.6-.6 1.28-.6 2.01A3.5 3.5 0 0 0 8.5 21 3.5 3.5 0 0 0 12 18.5h2A3.5 3.5 0 0 0 17.5 21 3.5 3.5 0 0 0 21 17.5c0-1.23-.66-2.29-1.64-2.86L21 7H7V4zm0 4h12l-1.5 6.5H9L7 8z"/></svg></div>
<div class="under-txt share-label"></div>
<div class="icon-wrap comment" title="کامنت‌ها"><svg viewBox="0 0 24 24"><path d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/></svg></div>
<div class="under-txt cmt-label" data-cmtcount>۰</div>
<div class="icon-wrap fav" title="علاقه‌مندی">
<svg class="heart-outline" viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.9 7.1 7 5.5 8.6a4.3 4.3 0 0 0 0 6.1L12 21l6.5-6.3a4.3 4.3 0 0 0 0-6.1c-1.6-1.6-4.6-1.7-6.4.04z" fill="none" stroke="white" stroke-width="1.6"/></svg>
<svg class="heart-filled" viewBox="0 0 24 24"><path d="M12.1 21.35l-1.1-1.01C5.14 15.28 2 12.36 2 8.99 2 6.42 4.42 4 7 4c1.54 0 3.04.73 4 1.87C11.96 4.73 13.46 4 15 4c2.58 0 5 2.42 5 4.99 0 3.37-3.14 6.29-8.9 11.35z"/></svg>
</div>
<div class="under-txt fav-label" data-favcount>۰</div>
</div>
<span class="title">ماجراهای من و درسام – خیلی‌سبز <span class="dcount" data-dlc>(۰ دانلود)</span></span>
<div class="star-tip"></div>
</div>
</li>

<!-- جزوه: فصل دوم -->
<li data-id="riazi10-fasle2">
<div class="book-card" data-href="https://s34.picofile.com/d/8486791326/9341ca47-90ec-48d6-85c2-6a9f9bf6f5e1/riazi10_fasle2.pdf">
<div class="left-acts">
<div class="icon-wrap dl" title="دانلود"><svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM11 4h2v8h3l-4 4-4-4h3V4z"/></svg></div>
<div class="icon-wrap star" title="امتیاز"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.86L18.18 22 12 18.56 5.82 22 7 14.13 2 9.27l6.91-1.01L12 2z"/></svg></div>
<div class="under-txt size-label" data-size>2 MB</div>
<div class="under-txt rate-label" data-rate>؟</div>
<div class="icon-wrap share" title="اشتراک‌گذاری"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.28 3.28 0 0 0 0-1.39l7.13-4.12A2.99 2.99 0 0 0 18 7a3 3 0 1 0-3-3c0 .23.03.45.08.66L7.91 9.77A3 3 0 0 0 6 9a3 3 0 1 0 0 6c.73 0 1.4-.26 1.91-.69l7.21 4.2c-.05.2-.08.41-.08.63A3 3 0 1 0 18 16.08z"/></svg></div>
<div class="icon-wrap buy" title="خرید"><svg viewBox="0 0 24 24"><path d="M7 4H5l-1 2H0v2h2l3.6 7.59c-.35.6-.6 1.28-.6 2.01A3.5 3.5 0 0 0 8.5 21 3.5 3.5 0 0 0 12 18.5h2A3.5 3.5 0 0 0 17.5 21 3.5 3.5 0 0 0 21 17.5c0-1.23-.66-2.29-1.64-2.86L21 7H7V4zm0 4h12l-1.5 6.5H9L7 8z"/></svg></div>
<div class="under-txt share-label"></div>
<div class="icon-wrap comment" title="کامنت‌ها"><svg viewBox="0 0 24 24"><path d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/></svg></div>
<div class="under-txt cmt-label" data-cmtcount>۰</div>
<div class="icon-wrap fav" title="علاقه‌مندی">
<svg class="heart-outline" viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.9 7.1 7 5.5 8.6a4.3 4.3 0 0 0 0 6.1L12 21l6.5-6.3a4.3 4.3 0 0 0 0-6.1c-1.6-1.6-4.6-1.7-6.4.04z" fill="none" stroke="white" stroke-width="1.6"/></svg>
<svg class="heart-filled" viewBox="0 0 24 24"><path d="M12.1 21.35l-1.1-1.01C5.14 15.28 2 12.36 2 8.99 2 6.42 4.42 4 7 4c1.54 0 3.04.73 4 1.87C11.96 4.73 13.46 4 15 4c2.58 0 5 2.42 5 4.99 0 3.37-3.14 6.29-8.9 11.35z"/></svg>
</div>
<div class="under-txt fav-label" data-favcount>۰</div>
</div>
<span class="title">جزوه‌ی فصل دوم – ریاضی با محسنی (تلگرام) <span class="dcount" data-dlc>(۰ دانلود)</span></span>
<div class="star-tip"></div>
</div>
</li>

<!-- جزوه: فصل سوم -->
<li data-id="riazi10-fasle3">
<div class="book-card" data-href="https://s34.picofile.com/d/8486791334/5c4775a3-96f4-431e-83aa-d96d4b5c82fd/riazi10_fasle3.pdf">
<div class="left-acts">
<div class="icon-wrap dl" title="دانلود"><svg viewBox="0 0 24 24"><path d="M5 20h14v-2H5v2zM11 4h2v8h3l-4 4-4-4h3V4z"/></svg></div>
<div class="icon-wrap star" title="امتیاز"><svg viewBox="0 0 24 24"><path d="M12 2l3.09 6.26L22 9.27l-5 4.86L18.18 22 12 18.56 5.82 22 7 14.13 2 9.27l6.91-1.01L12 2z"/></svg></div>
<div class="under-txt size-label" data-size>1 MB</div>
<div class="under-txt rate-label" data-rate>؟</div>
<div class="icon-wrap share" title="اشتراک‌گذاری"><svg viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7a3.28 3.28 0 0 0 0-1.39l7.13-4.12A2.99 2.99 0 0 0 18 7a3 3 0 1 0-3-3c0 .23.03.45.08.66L7.91 9.77A3 3 0 0 0 6 9a3 3 0 1 0 0 6c.73 0 1.4-.26 1.91-.69l7.21 4.2c-.05.2-.08.41-.08.63A3 3 0 1 0 18 16.08z"/></svg></div>
<div class="icon-wrap buy" title="خرید"><svg viewBox="0 0 24 24"><path d="M7 4H5l-1 2H0v2h2l3.6 7.59c-.35.6-.6 1.28-.6 2.01A3.5 3.5 0 0 0 8.5 21 3.5 3.5 0 0 0 12 18.5h2A3.5 3.5 0 0 0 17.5 21 3.5 3.5 0 0 0 21 17.5c0-1.23-.66-2.29-1.64-2.86L21 7H7V4zm0 4h12l-1.5 6.5H9L7 8z"/></svg></div>
<div class="under-txt share-label"></div>
<div class="icon-wrap comment" title="کامنت‌ها"><svg viewBox="0 0 24 24"><path d="M20 2H4a2 2 0 0 0-2 2v18l4-4h14a2 2 0 0 0 2-2V4a2 2 0 0 0-2-2z"/></svg></div>
<div class="under-txt cmt-label" data-cmtcount>۰</div>
<div class="icon-wrap fav" title="علاقه‌مندی">
<svg class="heart-outline" viewBox="0 0 24 24"><path d="M12.1 8.64l-.1.1-.11-.11C10.14 6.9 7.1 7 5.5 8.6a4.3 4.3 0 0 0 0 6.1L12 21l6.5-6.3a4.3 4.3 0 0 0 0-6.1c-1.6-1.6-4.6-1.7-6.4.04z" fill="none" stroke="white" stroke-width="1.6"/></svg>
<svg class="heart-filled" viewBox="0 0 24 24"><path d="M12.1 21.35l-1.1-1.01C5.14 15.28 2 12.36 2 8.99 2 6.42 4.42 4 7 4c1.54 0 3.04.73 4 1.87C11.96 4.73 13.46 4 15 4c2.58 0 5 2.42 5 4.99 0 3.37-3.14 6.29-8.9 11.35z"/></svg>
</div>
<div class="under-txt fav-label" data-favcount>۰</div>
</div>
<span class="title">جزوه‌ی فصل سوم – ریاضی با محسنی (تلگرام) <span class="dcount" data-dlc>(۰ دانلود)</span></span>
<div class="star-tip"></div>
</div>
</li>



</ul>
</section>








<div style="text-align:center">
<a class="btn-back" href="index.html">بازگشت به منوی اصلی</a>
</div>

<div id="counter"><span id="visit-count">در حال بارگذاری...</span></div>

<!-- مودال پیش‌نمایش -->
<div class="modal" id="previewModal">
<div class="box">
<h3 id="pvTitle">پیش‌نمایش</h3>
<div id="pvBody" style="line-height:1.9;font-size:14.5px;opacity:.95"></div>
<div class="row"><button id="pvClose" class="btn gray">بستن</button></div>
</div>
</div>

<!-- مودال مرتب‌سازی -->
<div class="modal-sort" id="sortModal">
<div class="box">
<div class="sort-title">مرتب‌سازی بر اساس</div>
<ul class="sort-list" id="sortList">
<li data-sort="default" class="active">پیش‌فرض</li>
<li data-sort="rate">بیشترین امتیاز</li>
<li data-sort="downloads">بیشترین دانلود</li>
<li data-sort="likes">بیشترین لایک</li>
<li data-sort="size">کم‌حجم‌ترین</li>
</ul>
<div class="row"><button class="btn gray" id="btnSortClose">بستن</button></div>
</div>
</div>

<!-- مودال کامنت‌ها -->
<div class="modal-cmt" id="cmtModal">
<div class="box">
<h3 id="cmtTitle">کامنت‌ها</h3>
<ul class="cmt-list" id="cmtList"></ul>
<input class="cmt-name" id="cmtName" maxlength="40" placeholder="نام مستعار (اختیاری)" />
<textarea class="cmt-input" id="cmtInput" placeholder="کامنت جدید"></textarea>
<div class="cmt-foot">
<button class="btn gray" id="cmtClose">بستن</button>
<button class="btn" id="cmtSend">ارسال کامنت</button>
</div>
<div class="cmt-rule">ارسال نظر برای همه کاربران آزاد است.</div>
</div>
</div>

<!-- مودال گالری تصاویر -->
<div class="modal" id="galleryModal" style="display:none">
<div class="box" style="padding:12px">
<h3 id="galTitle" style="margin-bottom:10px">گالری تصاویر</h3>
<div id="galWrap" style="position:relative; overflow:hidden">
<div id="galStrip" style="display:flex; gap:6px; overflow-x:auto; scroll-behavior:smooth; padding:2px">
<!-- تصاویر اینجا تزریق می‌شن -->
</div>
</div>
<div class="row" style="margin-top:8px">
<button id="galClose" class="btn gray">بستن</button>
</div>
</div>
</div>

<!-- مودال ویدیوها -->
<div class="modal" id="videoModal" style="display:none">
  <div class="box" style="padding:14px 16px">
    <h3 id="videoTitle" style="margin-bottom:8px">پخش آنلاین</h3>

    <div style="display:flex; gap:8px; align-items:center; margin-bottom:10px">
      <label for="videoSelect" class="sort-title" style="margin:0">انتخاب ویدیو:</label>
      <select id="videoSelect">
      </select>
    </div>

    <!-- پلیر -->
    <div id="videoPlayer" style="background:rgba(0,0,0,.25); border:1px solid rgba(255,255,255,.2); border-radius:12px; overflow:hidden; min-height:220px"></div>

    <div class="row" style="margin-top:12px">
      <button id="videoClose" class="btn gray">بستن</button>
    </div>
  </div>
</div>

<style>
  /* حالت بسته (فقط وقتی انتخاب نشون داده میشه) */
  #videoSelect {
    flex: 1;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,.25);
    background: rgba(103, 64, 64, 0.1); /* رنگ بسته */
    color: #fff;
    padding: 8px 10px;
    font-family: inherit;
  }

  /* آیتم‌های داخل منو وقتی باز میشه */
  #videoSelect option {
    background: rgba(30,30,30,.85); /* رنگ باز */
    color: #fff;
  }
</style>

  
<!-- مودال فیلتر برچسب‌ها -->
<div class="modal-sort" id="tagsModal" style="display:none">
<div class="box">
<div class="sort-title">فیلتر بر اساس برچسب‌ها</div>
<div id="tagsContainer" class="tags-container"></div>
<div class="row" style="gap:8px; flex-wrap:wrap">
<button class="btn btn-danger" type="button" id="btnTagsDeleteAll">حذف همه‌ی فیلترها</button>
<button class="btn gray" type="button" id="btnTagsCancel">لغو</button>
<button class="btn" type="button" id="btnTagsApply">اعمال</button>
</div>
</div>
</div>

<script>
/* ---- کمک‌تابع اعداد فارسی ---- */
const faDigits = n => (typeof n==='number'? n.toLocaleString('fa-IR') : (''+n).replace(/\d/g,d=>'۰۱۲۳۴۵۶۷۸۹'[d]));
const faRate = v => (v==null? '؟' : (''+v).replace(/\./g,'٫').replace(/\d/g,d=>'۰۱۲۳۴۵۶۷۸۹'[d]));

/* ---- شمارنده بازدید صفحه ---- */
async function loadVisits(){
const slug='riazi';
try{
  const r=await fetch(API_BASE + `/api/visits?slug=${encodeURIComponent(slug)}`,{cache:'no-store'});
const d=await r.json();
if(!r.ok||typeof d.value!=='number')throw 0;
document.getElementById('visit-count').textContent=`بازدید این صفحه: ${faDigits(d.value)}`;
await fetch(API_BASE + `/api/log?slug=${encodeURIComponent(slug)}`,{
method:'POST',headers:{'Content-Type':'application/json'},
body:JSON.stringify({ua:navigator.userAgent})
});
}catch{
document.getElementById('visit-count').textContent='خطا در دریافت شمارنده';
}
}
loadVisits();

/* ---- داده‌های ثابت هر کتاب ---- */

const bookMeta = {
"riazi-shab": {
size: "20 MB",
rate: 4.5,
votes: 53,
buy: "https://www.digikala.com/product/dkp-820863/کتاب-شب-امتحان-ریاضی-و-آمار-پایه-یازدهم-انسانی-اثر-مهندس-امیر-زراندوز/",
publisher: "خیلی‌سبز",
tags: ["تست","درسنامه","تشریحی","پایه یازدهم","خیلی‌سبز","شب امتحان"],
downloads: 0
},
"riazi10-shab": {
size: "21 MB",
rate: 4.5,
votes: 86,
buy: "https://www.digikala.com/product/dkp-4123983/کتاب-شب-امتحان-ریاضی-و-آمار-دهم-انسانی-اثر-مهندس-امیر-زراندوز-انتشارات-خیلی-سبز/",
publisher: "خیلی‌سبز",
tags: ["تست","تشریحی","درسنامه","پایه دهم","خیلی‌سبز","شب امتحان"],
downloads: 0
},
"riazi10-majaraha": {
size: "54 MB",
rate: 4.3,
votes: 90,
buy: "https://www.digikala.com/product/dkp-4114621/کتاب-ماجراهای-من-و-درسام-ریاضی-و-آمار-دهم-انسانی-اثر-امیر-زراندوز-انتشارات-خیلی-سبز/",
publisher: "خیلی‌سبز",
tags: ["تشریحی","درسنامه","پایه دهم","خیلی‌سبز","ماجراهای من و درسام"],
downloads: 0
},
"riazi10,11,12-jambakdi": {
size: "53 MB",
rate: null,
votes: 0,
buy: null,
publisher: "مهر و ماه",
tags: ["تست","درسنامه","جامع","مهر و ماه","تست کنکوری"],
downloads: 0
},
"riazi10-fasle2": {
size: "2 MB",
rate: null,
votes: 0,
buy: null, // اینجا بعدا هندل می‌کنیم که بگه توی تلگرام رایگان منتشر شده
publisher: "ریاضی با محسنی",
tags: ["تست","درسنامه","تست کنکوری","پایه دهم","تشریحی","ریاضی با محسنی"],
downloads: 0
},
"riazi10-fasle3": {
size: "1 MB",
rate: null,
votes: 0,
buy: null,
publisher: "ریاضی با محسنی",
tags: ["تست","درسنامه","پایه دهم","تشریحی","ریاضی با محسنی"],
downloads: 0
},
"riazi11-AllFasl": {
size: "1 MB",
rate: null,
votes: 0,
buy: null,
publisher: "ریاضی با محسنی",
tags: ["تست","درسنامه","امتحان نهایی","پایه یازدهم","تشریحی","ریاضی با محسنی"],
downloads: 0
}
};





/* ---- ابزارهای محلی/عمومی ---- */
function lsGet(k,d){try{return JSON.parse(localStorage.getItem(k))??d}catch{return d}}
function lsSet(k,v){localStorage.setItem(k,JSON.stringify(v))}
const deviceId=(localStorage.getItem('device_id') || (()=>{const v='dvc_'+Math.random().toString(36).slice(2);localStorage.setItem('device_id',v);return v})());

/* ---- دانلودها ---- */
async function getDownloads(book){
try{
  const r=await fetch(API_BASE + `/api/downloads?book=${encodeURIComponent(book)}`,{cache:'no-store'});
const d=await r.json(); if(!r.ok||typeof d.value!=='number') throw 0;
return d.value;
}catch{return lsGet('dl_'+book,0)}
}
async function addDownload(book){
try{
  const r=await fetch(API_BASE + '/api/downloads',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({book,inc:1})});
const d=await r.json(); if(!r.ok||typeof d.value!=='number') throw 0;
return d.value;
}catch{
const v=lsGet('dl_'+book,0)+1; lsSet('dl_'+book,v); return v;
}
}

/* ---- جست‌وجو ---- */
const searchInput=document.getElementById('searchInput');
const searchClear=document.getElementById('searchClear');
function normalize(s){
return String(s||'')
.replace(/\u200c/g,' ')
.replace(/[‌\u00A0]/g,' ')
.replace(/ي/g,'ی').replace(/ك/g,'ک')
.replace(/\s+/g,' ')
.toLowerCase();
}
function filterBooks(){
const v=normalize(searchInput.value||'');
document.querySelectorAll('.books li').forEach(li=>{
const t=li.querySelector('.title').textContent;
li.style.display = normalize(t).includes(v) ? '' : 'none';
});
searchClear.style.display = v? 'flex':'none';
}
searchInput.addEventListener('input',filterBooks);
searchClear.addEventListener('click',()=>{searchInput.value='';filterBooks();searchInput.focus()});

/* ---- مرتب‌سازی پنل‌محور با بازگشت به ترتیب اولیه ---- */
const sortBtn=document.getElementById('btnSort');
const sortModal=document.getElementById('sortModal');
const sortList=document.getElementById('sortList');
const sortClose=document.getElementById('btnSortClose');
let currentSort='default';

function openSort(){
sortModal.style.display = 'flex'; // نمایش مودال با display flex
setTimeout(() => sortModal.classList.add('show'), 10); // اضافه کردن کلاس show برای نمایش مودال
}
function closeSort(){sortModal.classList.remove('show');setTimeout(()=>sortModal.style.display='none',160)}
sortBtn.addEventListener('click',openSort);
sortClose.addEventListener('click',closeSort);
sortModal.addEventListener('click',e=>{if(e.target===sortModal)closeSort()});

/* ثبت ترتیب اولیه هر پنل */
function captureInitialOrder(){
document.querySelectorAll('ul.books').forEach(ul=>{
Array.from(ul.children).forEach((li,idx)=>{ li.dataset.order = String(idx) });
});
}
captureInitialOrder();

sortList.querySelectorAll('li').forEach(li=>{
li.addEventListener('click',async()=>{
sortList.querySelectorAll('li').forEach(x=>x.classList.remove('active'));
li.classList.add('active'); currentSort=li.dataset.sort;
await applySort(); sortBtn.textContent='مرتب‌سازی: '+li.textContent.trim(); closeSort();
})
});

function numFromSize(sizeStr){
if(!sizeStr) return 9e9;
const m=(sizeStr.match(/\d+/)||[0])[0];
return parseInt(m,10)||9e9;
}

async function applySort(){
const panels=[{ul:document.getElementById('list11'), key:'11'},{ul:document.getElementById('list10'), key:'10'},{ul:document.getElementById('list12'), key:'12'}];

panels.forEach(({ul})=>{
if(!ul) return;
const items=Array.from(ul.children).map(li=>{
const id=li.dataset.id, meta=bookMeta[id]||{};
const dl = parseInt(li.dataset.dl||'0',10);
const fav= parseInt(li.dataset.fav||'0',10);
const size=numFromSize(meta.size);
const rate=(meta.rate==null? -1 : meta.rate);
const order=parseInt(li.dataset.order||'0',10);
return {li,id,dl,fav,size,rate,order};
});

switch(currentSort){
case 'rate': items.sort((a,b)=>b.rate-a.rate); break;
case 'downloads': items.sort((a,b)=>b.dl-a.dl); break;
case 'likes': items.sort((a,b)=>b.fav-a.fav); break;
case 'size': items.sort((a,b)=>a.size-b.size); break;
default: items.sort((a,b)=>a.order-b.order);break;
}
items.forEach(it=>ul.appendChild(it.li));
});
}

/* ---- مودال پیش‌نمایش ---- */
const pvModal=document.getElementById('previewModal');
const pvTitle=document.getElementById('pvTitle');
const pvBody=document.getElementById('pvBody');
const pvClose=document.getElementById('pvClose');
pvClose.addEventListener('click',()=>{pvModal.classList.remove('show');setTimeout(()=>pvModal.style.display='none',180)});
pvModal.addEventListener('click',e=>{if(e.target===pvModal) pvClose.click()});

function openPreview(card,id){
const title = card.querySelector('.title').textContent.replace(/\(\d+ ?دانلود\)/,'').trim();
const href = card.dataset.href;
const meta = bookMeta[id]||{};
const tags = (meta.tags||[]).map(t=>`<span class="chip" style="pointer-events:none;opacity:.9">${t}</span>`).join(' ');
pvTitle.textContent='پیش‌نمایش «'+title+'»';
pvBody.innerHTML =
`<div>حجم فایل: <b>${meta.size || 'نامشخص'}</b></div>
<div>لینک دانلود: ${href?`<a href="${href}" target="_blank" rel="noopener" style="color:#aef">باز کردن</a>`:'نامشخص'}</div>
<div>امتیاز دیجی‌کالا: <b>${meta.rate==null?'ناموجود':faRate(meta.rate)}</b> ${meta.votes?`(از ${faDigits(meta.votes)} رأی)`:''}</div>
<div style="margin-top:6px">خرید: ${meta.buy?`<a href="${meta.buy}" target="_blank" rel="noopener" style="color:#aef">مشاهده در دیجی‌کالا</a>`:'—'}</div>

<div style="margin-top:8px">برچسب‌ها: ${tags || '—'}</div>`;
pvModal.style.display='flex'; setTimeout(()=>pvModal.classList.add('show'),10);
}

/* ---- مودال کامنت‌ها ---- */
const cmtModal=document.getElementById('cmtModal');
const cmtTitle=document.getElementById('cmtTitle');
const cmtList=document.getElementById('cmtList');
const cmtInput=document.getElementById('cmtInput');
const cmtName=document.getElementById('cmtName');
const cmtSend=document.getElementById('cmtSend');
const cmtClose=document.getElementById('cmtClose');

let currentBookForCmt=null, currentCmtCounterEl=null;

function openCmtModal(bookId,title,counterEl){
currentBookForCmt=bookId; currentCmtCounterEl=counterEl;
cmtTitle.textContent='کامنت‌های '+title;
cmtInput.value=''; cmtName.value='';
cmtModal.style.display='flex'; setTimeout(()=>cmtModal.classList.add('show'),10);
loadComments(bookId);
}
function closeCmtModal(){ cmtModal.classList.remove('show'); setTimeout(()=>cmtModal.style.display='none',150) }
cmtClose.addEventListener('click',closeCmtModal);
cmtModal.addEventListener('click',e=>{ if(e.target===cmtModal) closeCmtModal() });

async function loadComments(bookId){
try{
  const r=await fetch(API_BASE + `/api/book-comments?slug=${encodeURIComponent(bookId)}`,{cache:'no-store'});
const d=await r.json();
if(!r.ok||!Array.isArray(d.list)) throw 0;
renderComments(d.list);
if(currentCmtCounterEl) currentCmtCounterEl.textContent=faDigits(d.list.length);
}catch{
renderComments([]); if(currentCmtCounterEl) currentCmtCounterEl.textContent='۰';
}
}
function renderComments(list){
cmtList.innerHTML='';
list.forEach(c=>{
const li=document.createElement('li'); li.className='cmt-item';
const head=document.createElement('div'); head.className='cmt-head';
const uname=document.createElement('span');
const nick = (c.nickname && c.nickname.trim()) ? c.nickname : 'کاربر ناشناس';
uname.textContent = nick;
head.appendChild(uname);
const text=document.createElement('div'); text.className='cmt-text';
text.textContent=(c.text||'');
li.appendChild(head); li.appendChild(text);
cmtList.appendChild(li);
});
}
cmtSend.addEventListener('click',async()=>{
const txt=(cmtInput.value||'').trim();
const nick=(cmtName.value||'').trim();
if(!txt) return;
try{
  const r=await fetch(API_BASE + `/api/book-comments?slug=${encodeURIComponent(currentBookForCmt)}`,{
method:'POST', headers:{'Content-Type':'application/json'},
body:JSON.stringify({text:txt, nickname:nick})
});
const d=await r.json();
if(r.ok && d && d.ok){ cmtInput.value=''; cmtName.value=''; await loadComments(currentBookForCmt); }
else alert('ارسال نشد.');
}catch{ alert('ارسال نشد.'); }
});

/* ---- کارت‌ها + علاقه‌مندی‌ها + اشتراک‌گذاری با متن ثابت ---- */
function initCards(){
  const SITE_URL = (window.SITE_URL_OVERRIDE || 'https://learnbooks.pages.dev/');
  const RTL = '\u200F';

  const makeRatingText = (meta)=>{
    if (meta.rate==null) return 'ناموجود';
    const r = faRate(meta.rate);
    return `${r}${meta.votes?` (از ${faDigits(meta.votes)} رأی)`:''}`;
  };

  function makeShareText(title, dl, meta){
    const buy = meta.buy || '—';
    const rating = makeRatingText(meta);
    return [
      `${RTL}📘 نام کتاب:`,
      title,
      '',
      `${RTL}📥 لینک دانلود PDF:`,
      dl || '—',
      '',
      `${RTL}🛒 لینک خرید (دیجی‌کالا):`,
      buy,
      '',
      `${RTL}⭐ امتیاز:`,
      rating,
      '',
      `${RTL}🌐 برای کتاب‌های بیشتر:`,
      SITE_URL
    ].join('\n');
  }

  document.querySelectorAll('.book-card').forEach(card=>{
    const li = card.closest('li');
    if(!li) return;

    const id = li.dataset.id;
    const meta = bookMeta[id] || {};

    const countEl     = card.querySelector('[data-dlc]');
    const starTip     = card.querySelector('.star-tip');
    const rateEl      = card.querySelector('[data-rate]');
    const sizeEl      = card.querySelector('[data-size]');
    const cmtCountEl  = card.querySelector('[data-cmtcount]');
    const favLbl      = card.querySelector('[data-favcount]');
    const favBtn      = card.querySelector('.icon-wrap.fav');

    const btnStar     = card.querySelector('.icon-wrap.star');
    const btnShare    = card.querySelector('.icon-wrap.share');
    const btnBuy      = card.querySelector('.icon-wrap.buy');
    const btnDl       = card.querySelector('.icon-wrap.dl');
    const btnCmt      = card.querySelector('.icon-wrap.comment');

    const titleText = (card.querySelector('.title')?.firstChild?.textContent || '').trim();

    // سایز و امتیاز (در صورت وجود المنت)
    if (sizeEl) {
      const faDigitsInSize = (sizeStr) => {
        if (!sizeStr) return '—';
        let match = sizeStr.match(/^(\d+)/);
        if (!match) return sizeStr;
        let num = match[1];
        let rest = sizeStr.slice(num.length);
        return faDigits(Number(num)) + rest;
      };
      sizeEl.textContent = meta.size ? faDigitsInSize(meta.size) : '—';
    }
    if (rateEl) rateEl.textContent = faRate(meta.rate);

    // دانلودشمار (در صورت وجود کانتر)
    if (countEl) {
      getDownloads(id).then(v=>{
        li.dataset.dl = String(v||0);
        countEl.textContent = `(${faDigits(v||0)} دانلود)`;
      });
    }

    // Tooltip امتیاز (اگر آیکن هست)
    if (btnStar && starTip) {
      btnStar.addEventListener('click', e=>{
        e.stopPropagation();
        let msg = (meta.rate==null)
          ? 'برای این کتاب امتیازی در دیجی‌کالا ثبت نشده است'
          : `${faRate(meta.rate)} از ۵ ${meta.votes?`(بر اساس ${faDigits(meta.votes)} رأی)`:''}`;
        starTip.textContent = msg;
        starTip.classList.remove('hide'); starTip.classList.add('show');
        setTimeout(()=>{ starTip.classList.remove('show'); starTip.classList.add('hide') }, 6000);
      });
    }

    // اشتراک‌گذاری
    if (btnShare) {
      btnShare.addEventListener('click', async e=>{
        e.stopPropagation();
        const dl = card.dataset.href || '';
        const text = makeShareText(titleText, dl, meta);
        if (navigator.share) {
          try { await navigator.share({ title: titleText, text }); } catch {}
        } else {
          try {
            await navigator.clipboard.writeText(text);
            alert('متن اشتراک‌گذاری کپی شد ✅');
          } catch {
            alert('کپی نشد؛ لطفاً دستی کپی کنید.');
          }
        }
      });
    }

    // خرید
    if (btnBuy) {
      btnBuy.addEventListener('click', e=>{
        e.stopPropagation();
        if (meta.buy) window.open(meta.buy,'_blank','noopener');
      });
    }

    // دانلود
    if (btnDl && countEl) {
      btnDl.addEventListener('click', async e=>{
        e.stopPropagation();
        const nv = await addDownload(id);
        li.dataset.dl = String(nv||0);
        countEl.textContent = `(${faDigits(nv||0)} دانلود)`;
        const href = card.dataset.href; if (href) window.open(href,'_blank','noopener');
      });
    } else if (btnDl) {
      // اگر کانتر نبود، فقط باز کنه
      btnDl.addEventListener('click', e=>{
        e.stopPropagation();
        const href = card.dataset.href; if (href) window.open(href,'_blank','noopener');
      });
    }

    // کامنت‌ها
    if (btnCmt && cmtCountEl) {
      btnCmt.addEventListener('click', e=>{
        e.stopPropagation();
        openCmtModal(id, '«'+titleText+'»', cmtCountEl);
      });

      // لود اولیه تعداد کامنت
      fetch(API_BASE + `/api/book-comments?slug=${encodeURIComponent(id)}`,{cache:'no-store'})
        .then(r=>r.json())
        .then(d=>{
          cmtCountEl.textContent = faDigits(Array.isArray(d.list)? d.list.length : 0);
        }).catch(()=>{ cmtCountEl.textContent='۰' });
    }

    // علاقه‌مندی (اگر وجود دارد)
    if (favBtn && favLbl) {
      const FAVS_KEY='my_favs';
      const getMyFavs=()=>{ try{return JSON.parse(localStorage.getItem(FAVS_KEY))||[]}catch{return []} };
      const setMyFavs=v=>localStorage.setItem(FAVS_KEY, JSON.stringify(v));
      const isMyFav=id=>getMyFavs().includes(id);
      const addMyFav=id=>{ const s=new Set(getMyFavs()); s.add(id); setMyFavs([...s]) };
      const removeMyFav=id=>{ const s=new Set(getMyFavs()); s.delete(id); setMyFavs([...s]) };

      async function favGet(book){
        try{
          const r=await fetch(API_BASE + `/api/favorites?book=${encodeURIComponent(book)}&device=${encodeURIComponent(deviceId)}`,{cache:'no-store'});
          const d=await r.json(); return { count: d?.count ?? 0, isFav: !!d?.isFav };
        }catch{ return {count: (isMyFav(book)?1:0), isFav: isMyFav(book)} }
      }
      async function favToggle(book, toAdd){
        try{
          const r=await fetch(API_BASE + '/api/favorites', { method:'POST', headers:{'Content-Type':'application/json'},
            body: JSON.stringify({ book, device: deviceId, op: toAdd?'add':'remove' }) });
          const d=await r.json();
          if(!r.ok) throw 0;
          return { count: d?.count ?? 0, isFav: !!d?.isFav };
        }catch{
          if (toAdd) addMyFav(book); else removeMyFav(book);
          return { count: 0, isFav: isMyFav(book) };
        }
      }

      // لود اولیه لایک
      favGet(id).then(({count,isFav})=>{
        favLbl.textContent=faDigits(count||0);
        li.dataset.fav = String(count||0);
        if(isFav) addMyFav(id); else removeMyFav(id);
        favBtn.classList.toggle('active', isFav);
      }).catch(()=>{ li.dataset.fav='0'; });

      favBtn.addEventListener('click', async (e)=>{
        e.stopPropagation();
        const willAdd=!favBtn.classList.contains('active');
        try{
          const {count,isFav}=await favToggle(id, willAdd);
          favLbl.textContent=faDigits(count||0);
          li.dataset.fav = String(count||0);
          if(isFav) addMyFav(id); else removeMyFav(id);
          favBtn.classList.toggle('active', isFav);
        }catch{}
      });
    }

    // کلیک روی کارت:
    // 1) اگر data-gallery دارد => گالری
    // 2) اگر data-video دارد => کاری نکن (wireVideoRow خودش مدیریت می‌کند)
    // 3) وگرنه => پیش‌نمایش
    if (card.hasAttribute('data-gallery')) {
      const key = card.dataset.gallery;
      const t   = titleText;
      card.addEventListener('click', (e)=>{ e.stopPropagation(); window.openGallery(key, t); });
    } else if (card.hasAttribute('data-video')) {
      // هیچ کاری اینجا نکن؛ wireVideoRow بعداً هندل می‌کند
    } else {
      card.addEventListener('click', ()=> openPreview(card,id));
    }

// ... داخل initCards و درست قبل از:
// if (card.hasAttribute('data-gallery')) { ... } else { card.addEventListener('click',()=> openPreview(card,id)); }

if (card.hasAttribute('data-gallery')) {
  // گالری
  const key = card.dataset.gallery;
  const titleText = card.querySelector('.title')?.firstChild?.textContent?.trim() || '';
  card.addEventListener('click', (e)=>{ e.stopPropagation(); window.openGallery(key, titleText); });
} 
else if (card.hasAttribute('data-video')) {
  // ⚠️ روی کارت ویدیویی هیچ handler پیش‌نمایشی ست نکن
  // wireVideoRow / delegation خودش بازش می‌کند
} 
else {
  card.addEventListener('click',()=> openPreview(card,id));
}

// کلیک روی کارت:
if (card.hasAttribute('data-gallery')) {
  const key = card.dataset.gallery;
  const t   = titleText;
  card.addEventListener('click', (e)=>{
    e.stopPropagation();
    window.openGallery(key, t);
  });
} else if (card.hasAttribute('data-video')) {
  // عمداً هیچ handler پیش‌نمایشی ثبت نکن؛
  // باز شدن مودال ویدیو را wireVideoRow + delegation مدیریت می‌کند.
} else {
  card.addEventListener('click', ()=> openPreview(card,id));
}


});
}
initCards();
</script>



<script>


// فقط یک بار تعریف بشه

const galleries = {
'arabi10-lessons': [
'https://s33.picofile.com/file/8484585200/%D8%AF%D8%B1%D8%B3_%D8%A7%D9%88%D9%84.jpg',
'https://s33.picofile.com/file/8484585218/%D8%AF%D8%B1%D8%B3_%D8%AF%D9%88%D9%85_1.jpg',
'https://s33.picofile.com/file/8484585226/%D8%AF%D8%B1%D8%B3_%D8%AF%D9%88%D9%85_2.jpg',
'https://s33.picofile.com/file/8484585234/%D8%AF%D8%B1%D8%B3_%D8%B3%D9%88%D9%85_1.jpg',
'https://s33.picofile.com/file/8484585242/%D8%AF%D8%B1%D8%B3_%D8%B3%D9%88%D9%85_2.jpg',
'https://s33.picofile.com/file/8484585292/%D8%AF%D8%B1%D8%B3_%D8%B4%D8%B4%D9%85_1.jpg',
'https://s33.picofile.com/file/8484585300/%D8%AF%D8%B1%D8%B3_%D8%B4%D8%B4%D9%85_2.jpg',
'https://s33.picofile.com/file/8484585326/%D8%AF%D8%B1%D8%B3_%D8%B4%D8%B4%D9%85_3.jpg',
'https://s33.picofile.com/file/8484585350/%D8%AF%D8%B1%D8%B3_%D9%87%D9%81%D8%AA%D9%85_1.jpg',
'https://s33.picofile.com/file/8484585368/%D8%AF%D8%B1%D8%B3_%D9%87%D9%81%D8%AA%D9%85_2.jpg',
'https://s33.picofile.com/file/8484585250/%D8%AF%D8%B1%D8%B3_%D9%BE%D9%86%D8%AC%D9%85_1.jpg',
'https://s33.picofile.com/file/8484585276/%D8%AF%D8%B1%D8%B3_%D9%BE%D9%86%D8%AC%D9%85_2.jpg',
'https://s33.picofile.com/file/8484585284/%D8%AF%D8%B1%D8%B3_%D9%BE%D9%86%D8%AC%D9%85_3.jpg',
'https://s33.picofile.com/file/8484585384/%D8%AF%D8%B3_%D9%87%D9%81%D8%AA%D9%85_3.jpg'
],
'arabi10-chiz': [
'https://interfaces-cdn.zapier.com/53f675ac-127c-4a31-a135-b56627fe7248/Screenshot20250105161927.png',
'https://interfaces-cdn.zapier.com/54b30e41-b8e1-4f51-aa6d-bbc30e2143de/riazi9452.png',
'https://interfaces-cdn.zapier.com/9e06452e-1941-4f23-b204-58e8de84c10e/Screenshot20250105233025.png',
'https://interfaces-cdn.zapier.com/8db713cd-7f11-409a-a0ba-bbf07519b005/Screenshot20250105233429.png',
'https://interfaces-cdn.zapier.com/6f689b15-a249-4b0f-8223-22801272280f/Screenshot20250106000207.png'
]
};

(function(){
const gModal = document.getElementById('galleryModal');
const gTitle = document.getElementById('galTitle');
const gStrip = document.getElementById('galStrip');
const gClose = document.getElementById('galClose');

function openGallery(key, titleText){
const list = galleries[key] || [];
if(!list.length) return;

gTitle.textContent = 'گالری «' + (titleText || 'صفحات کتاب') + '»';
gStrip.innerHTML = '';

list.forEach(src=>{
const cell = document.createElement('div');
const img = document.createElement('img');
img.loading = 'lazy';
img.decoding = 'async';
img.src = src;
img.alt = 'page';
img.style.maxWidth = '100%';
cell.appendChild(img);
gStrip.appendChild(cell);
});

gModal.style.display = 'flex';
setTimeout(()=>gModal.classList.add('show'), 10);
gStrip.scrollTo({left:0, behavior:'instant'});
}

// حتماً گلوبال کن تا initCards هم بتونه صداش کنه
window.openGallery = openGallery;

function closeGallery(){
gModal.classList.remove('show');
setTimeout(()=>{ gModal.style.display='none'; }, 160);
}

gClose.addEventListener('click', closeGallery);
gModal.addEventListener('click', e=>{ if(e.target===gModal) closeGallery(); });

// لیسنرِ آیکنِ ویو
document.querySelectorAll('.book-card[data-gallery] .icon-wrap.view').forEach(viewBtn=>{
viewBtn.addEventListener('click', e=>{
e.stopPropagation();
const card = viewBtn.closest('.book-card');
const key = card?.dataset?.gallery;
const titleText = card.querySelector('.title')?.firstChild?.textContent?.trim() || '';
openGallery(key, titleText);
});
});
})();
</script>

    

<script>
/* === فیلتر برچسب‌ها (چیپ) — بدون «سایر»، حذف فیلتر بدون بستن مودال === */
(function(){
const tagsModal = document.getElementById('tagsModal');
const tagsContainer = document.getElementById('tagsContainer');
const btnTagsApply = document.getElementById('btnTagsApply');
const btnTagsDeleteAll = document.getElementById('btnTagsDeleteAll');
const btnTagsCancel = document.getElementById('btnTagsCancel');
const btnTags = document.getElementById('btnTags');

const BASE_GROUPS = {
'نوع': ['تست','تست کنکوری','درسنامه','امتحان نهایی'],
'ناشر': ['خیلی‌سبز','گاج','مبتکران','مهر و ماه','مشاوران'],
'مدل کتاب': ['شب امتحان','ماجرای بیست','فرمول بیست','ماجراهای من و درسام',' جیبی نکته باز','ریاضی با محسنی','فصل آزمون','واقعا جامع کنکور','کتابچه جامع کنکور','لقمه','امتحانت'],
'پایه ی مد نظر': ['پایه دهم','پایه یازدهم','پایه دوازدهم','جامع ( ویژه ی هر سه پایه )']
};

let selectedTags = new Set();
let tempSelected = new Set();

function normalizeTag(s){
if (!s) return '';
return String(s)
.replace(/\u200c/g,' ')
.replace(/[‌\u00A0]/g,' ')
.replace(/ي/g,'ی').replace(/ك/g,'ک')
.replace(/\s+/g,' ')
.trim();
}

function openModal(){ tempSelected=new Set(selectedTags); render(); tagsModal.style.display='flex'; setTimeout(()=>tagsModal.classList.add('show'),10); }
function closeModal(){ tagsModal.classList.remove('show'); setTimeout(()=>tagsModal.style.display='none',160); }
btnTags.addEventListener('click', openModal);
tagsModal.addEventListener('click', e=>{ if(e.target===tagsModal) closeModal(); });

function render(){
const GROUPS = JSON.parse(JSON.stringify(BASE_GROUPS));
const displayMap = {};
Object.values(bookMeta||{}).forEach(m => (m.tags||[]).forEach(t=>{
const n=normalizeTag(t); if(!displayMap[n]) displayMap[n]=t;
}));
const setType = new Set(GROUPS['نوع'].map(normalizeTag));
const setPub = new Set(GROUPS['ناشر'].map(normalizeTag));
const setModel = new Set(GROUPS['مدل کتاب'].map(normalizeTag));
const setGrade = new Set(GROUPS['پایه ی مد نظر'].map(normalizeTag));

const existing = new Set();
Object.values(bookMeta||{}).forEach(m => (m.tags||[]).forEach(t=> existing.add(normalizeTag(t))));

// هر تگی که در گروه‌های بالا نیست، به "نوع" اضافه می‌شود
const toType = [...existing].filter(t=> !setPub.has(t) && !setModel.has(t) && !setGrade.has(t) && !setType.has(t));
GROUPS['نوع'] = [...GROUPS['نوع'], ...toType.map(n=>displayMap[n])];

let html='';
Object.entries(GROUPS).forEach(([g,tags])=>{
const seen=new Set();
const chips = tags
.filter(x=>{const n=normalizeTag(x); if(seen.has(n))return false; seen.add(n); return true;})
.sort((a,b)=>normalizeTag(a).localeCompare(normalizeTag(b),'fa'))
.map(t=> `<button type="button" class="chip" data-tag="${t}">${t}</button>`).join('');
html += `<div class="tag-group"><div class="tag-group-title">${g}</div><div class="tag-group-body">${chips}</div></div>`;
});
tagsContainer.innerHTML=html;

tempSelected.forEach(t=>{
const sel=normalizeTag(t);
tagsContainer.querySelectorAll('.chip').forEach(el=>{
if (normalizeTag(el.dataset.tag)===sel) el.classList.add('active');
});
});
}

tagsContainer.addEventListener('click', e=>{
const chip=e.target.closest('.chip'); if(!chip) return;
const tag=chip.dataset.tag; const n=normalizeTag(tag);
chip.classList.toggle('active');
if(chip.classList.contains('active')) tempSelected.add(n);
else tempSelected.delete(n);
});

function applyFilter(){
const active=[...selectedTags];
document.querySelectorAll('.books li').forEach(li=>{
const id=li.dataset.id, meta=(bookMeta||{})[id]||{};
const tags=(meta.tags||[]).map(normalizeTag);
const ok = active.length===0 ? true : active.every(t=> tags.includes(t));
li.style.display = ok ? '' : 'none';
});
}

btnTagsApply.addEventListener('click', ()=>{ selectedTags=new Set(tempSelected); applyFilter(); closeModal(); });
btnTagsDeleteAll.addEventListener('click', ()=>{
selectedTags.clear();
tempSelected.clear();
tagsContainer.querySelectorAll('.chip.active').forEach(c=>c.classList.remove('active'));
applyFilter(); // مودال باز می‌ماند
});
btnTagsCancel.addEventListener('click', ()=>{ tempSelected=new Set(selectedTags); closeModal(); });
})();
</script>

<!-- === Dual Counter Widget (Compact) === -->
<!-- === Zekr Widget (Salawat + Laan) === -->
<div id="gc-widget" style="
position:fixed; right:14px; bottom:14px; z-index:9999; direction:rtl; font-family:inherit;
transition: transform .18s ease, opacity .18s ease;
">
<div style="
background: rgba(255,255,255,0.12);
border: 1px solid rgba(255,255,255,0.2);
box-shadow: 0 8px 20px rgba(0,0,0,.35);
backdrop-filter: blur(6px);
color:#fff; padding:8px 10px; border-radius:12px; min-width:210px;
">
<div style="display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:4px">
<div style="font-weight:800; font-size:13.5px; text-shadow:0 2px 5px rgba(0,0,0,.45)">
ذکرهای همگانی
</div>
<button id="gc-close" aria-label="بستن" title="بستن" style="
width:24px; height:24px; border:none; border-radius:7px; cursor:pointer; color:#fff;
background:rgba(255,255,255,.18); box-shadow:0 3px 10px rgba(0,0,0,.3);
display:flex; align-items:center; justify-content:center; font-weight:900;
line-height:1;
">×</button>
</div>

<div style="display:grid; grid-template-columns: auto 1fr auto; align-items:center; gap:6px 8px">
<!-- Salawat row -->
<div style="opacity:.92; font-size:13px">صلوات:</div>
<b id="gc-salawat" style="font-size:13px; text-align:left">—</b>
<button id="gc-salawat-inc" style="
border:none; cursor:pointer; color:#fff; font-size:12px;
background: linear-gradient(135deg,#34d399,#10b981);
box-shadow: 0 5px 14px rgba(0,0,0,.32);
border-radius:8px; padding:6px 9px; font-family:inherit;
">+ اضافه</button>

<!-- Laan row -->
<div style="opacity:.92; font-size:13px">لعن عُمَر:</div>
<b id="gc-laan" style="font-size:13px; text-align:left">—</b>
<button id="gc-laan-inc" style="
border:none; cursor:pointer; color:#fff; font-size:12px;
background: linear-gradient(135deg,#f87171,#ef4444);
box-shadow: 0 5px 14px rgba(0,0,0,.32);
border-radius:8px; padding:6px 9px; font-family:inherit;
">+ اضافه</button>
</div>
</div>
</div>

<div id="gc-toast" style="
position:fixed; left:50%; transform:translateX(-50%) translateY(16px);
bottom:10px; z-index:10000; pointer-events:none;
opacity:0; transition: opacity .22s ease, transform .22s ease;
">
<div id="gc-toast-text" style="
background: rgba(0,0,0,.6); color:#fff; padding:8px 12px; border-radius:9px;
border:1px solid rgba(255,255,255,.2); box-shadow:0 8px 18px rgba(0,0,0,.35);
font-size:12.5px; backdrop-filter: blur(4px); white-space:nowrap;
"></div>
</div>

<script>
(function(){
// اعداد فارسی
const fa = v => (typeof v==='number' ? v.toLocaleString('fa-IR') : String(v).replace(/\d/g,d=>'۰۱۲۳۴۵۶۷۸۹'[d]));
// عناصر
const w = document.getElementById('gc-widget');
const valS= document.getElementById('gc-salawat');
const valL= document.getElementById('gc-laan');
const btnS= document.getElementById('gc-salawat-inc');
const btnL= document.getElementById('gc-laan-inc');
const btnX= document.getElementById('gc-close');
const toast = document.getElementById('gc-toast');
const toastText = document.getElementById('gc-toast-text');

// افکت دکمه‌ها
[btnS, btnL].forEach(b=>{
b.addEventListener('pointerdown', ()=> b.style.transform='scale(0.97)');
b.addEventListener('pointerup', ()=> b.style.transform='scale(1)');
b.addEventListener('pointercancel',()=> b.style.transform='scale(1)');
b.addEventListener('mouseleave', ()=> b.style.transform='scale(1)');
});

function showToast(msg){
toastText.textContent = msg;
toast.style.opacity = '1';
toast.style.transform = 'translateX(-50%) translateY(0)';
clearTimeout(showToast._t);
showToast._t = setTimeout(()=>{
toast.style.opacity = '0';
toast.style.transform = 'translateX(-50%) translateY(16px)';
}, 3200);
}

function closeWidget(){
w.style.opacity = '0';
w.style.transform = 'translateY(8px) scale(0.985)';
setTimeout(()=>{ w.style.display='none'; }, 160);
showToast('ابزار ذکر بسته شد؛ برای برگشتن، صفحه را رفرش کنید.');
}

// واکشی مقدارها
async function refresh(){
try{
const [rS, rL] = await Promise.all([
fetch(API_BASE + '/api/global-counter?type=salawat',{cache:'no-store'}),
fetch(API_BASE + '/api/global-counter?type=laan',{cache:'no-store'})
]);
const dS = await rS.json();
const dL = await rL.json();
if(!rS.ok || !rL.ok || typeof dS.value!=='number' || typeof dL.value!=='number') throw 0;
valS.textContent = fa(dS.value);
valL.textContent = fa(dL.value);
}catch{
valS.textContent = 'خطا';
valL.textContent = 'خطا';
}
}

async function inc(which){
const btn = which==='salawat' ? btnS : btnL;
btn.disabled = true;
try{
  const r = await fetch(API_BASE + `/api/global-counter?type=${which}`, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify({ inc: 1 }) });
const d = await r.json();
if(!r.ok || typeof d.value!=='number') throw 0;
if(which==='salawat') valS.textContent = fa(d.value);
else valL.textContent = fa(d.value);
}catch{
showToast('نتونستم افزایش بدم؛ دوباره تلاش کن.');
}finally{
btn.disabled = false;
}
}

btnS.addEventListener('click', ()=> inc('salawat'));
btnL.addEventListener('click', ()=> inc('laan'));
btnX.addEventListener('click', closeWidget);

refresh();
})();
</script>
<!-- === /Zekr Widget === -->



<!-- toast -->
<div id="gc-toast" style="
position:fixed; left:50%; transform:translateX(-50%) translateY(16px);
bottom:10px; z-index:10000; pointer-events:none;
opacity:0; transition: opacity .25s ease, transform .25s ease;
">
<div style="
background: rgba(0,0,0,.6); color:#fff; padding:7px 10px; border-radius:8px;
border:1px solid rgba(255,255,255,.2); box-shadow:0 4px 12px rgba(0,0,0,.25);
font-size:12.5px; backdrop-filter: blur(3px); white-space:nowrap;
" id="gc-toast-text"></div>
</div>

<script>
  /* ===== فهرست ویدیوهای پایه دهم ===== */
/* ===== فهرست ویدیوهای پایه دهم ===== */
const videoGroups = {
  riazi10: [
  {
  id: "video-riazi10-amoozeshabad-fasle1-darse1-1",
  title: "فصل اول - درس 1 | معادله و مسائل توصیفی",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/x03j8dd/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle1-darse2-1",
  title: "فصل اول - درس 2 | حل معادله درجه ۲ و کاربردها",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/z71r153/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle1-darse3-1",
  title: "فصل اول - درس 3 | معادله های شامل عبارت گویا",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/t413aj8/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle2-darse1-1",
  title: "فصل دوم - درس 1 | مفهوم تابع",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/d317s0o/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle2-darse2-1",
  title: "فصل دوم - درس 2 | ضابطه جبری تابع",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/mjA4z/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle2-darse3-1",
  title: "فصل دوم _ درس 3 | نمودار تابع خطی",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/z383ox0/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle2-darse4-1",
  title: "فصل دوم - درس 4 | نمودار تابع درجه ۲ (سهمی)",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/e8003iv/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle3-darse1-1",
  title: "فصل سوم - درس 1 | گرد آوری داده ها",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/e0265g3/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle3-darse2-1",
  title: "فصل 3 - درس دوم | معیار های گرایش به مرکز",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/h994kqw/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle3-darse3-1",
  title: "فصل 3 - درس سوم | معیار های پراکندگی",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/v14o831/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle4-darse1-1",
  title: "فصل 4 - درس اول | نمودار های یک متغیره",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/gzD9a/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi10-amoozeshabad-fasle4-darse2-1",
  title: " فصل 4 - درس دوم | نمودار های چند متغیره",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/uvbr6pg/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
}
  ],
  riazi11: [

  {
    id: "video-riazi11-amoozeshabad-fasle1-darse1-1",
    title: "فصل اول درس 1 | گزاره ها و ترکیب گزاره ها",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/jyx89r2/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle1-darse1-2",
    title: "فصل اول درس 1 ( قسمت دوم )",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/jhg74ai/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle1-darse2-1",
    title: "فصل اول درس 2 | استدلال ریاضی",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/zxdsttz/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle2-darse1-1",
    title: "فصل دوم - درس 1 | مفهوم تابع ( قسمت اول )",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/qzi3wuq/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle2-darse1-2",
    title: "فصل دوم ـ درس 1 | ثابت‌همانی‌چند‌ضابطه‌ای (قسمت‌دوم)",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/rjb9py9/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle2-darse2-1",
    title: "فصل دوم درس 2 | تابع پلکانی و قدر مطلقی (قسمت‌اول)",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/yji296p/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle2-darse2-2",
    title: "فصل دوم - درس 2 | تابع پلکانی و قدرمطلقی (قسمت‌دوم)",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/krsrufs/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle2-darse3-1",
    title: "فصل دوم - درس 3 | اعمال بر روی توابع",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/codw85l/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle3-darse1-1",
    title: "فصل سوم - درس 1 | شاخص های آماری",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/lcf5q6m/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  },

  {
    id: "video-riazi11-amoozeshabad-fasle3-darse2-1",
    title: "فصل سوم - درس 2 | سری های زمانی",
    html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/ydv89r8/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
  }

    ],

    riazi12: [
    {
  id: "video-riazi12-amoozeshabad-fasle1-darse1-1",
  title: "فصل اول | درس 1 - شمارش (قسمت اول)",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/vaqy96v/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle1-darse1-2",
  title: "فصل اول | درس 1 - شمارش (قسمت دوم)",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/lltn191/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle1-darse2-1",
  title: "فصل اول | درس 2 - احتمال (قسمت اول)",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/ckko335/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle1-darse2-2",
  title: "فصل اول | درس 2 - احتمال (قسمت دوم)",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/ehr29lf/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle1-darse2-3",
  title: "فصل اول - درس 2 | احتمال (قسمت آخر)",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/ewn41ed/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle1-darse3-1",
  title: "فصل اول | درس 3 - چرخه آمار در حل مسائل",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/dpks352/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle2-darse1-1",
  title: "فصل دوم - درس 1 | مدل سازی و دنباله",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/vhr0n37/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle2-darse2-1",
  title: "فصل دوم | درس 2 - دنباله حسابی",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/doa66pn/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle3-darse1-1",
  title: "فصل سوم | درس 1 - دنباله هندسی",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/mrsrd14/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle3-darse2-1",
  title: "فصل سوم | درس 2 - ریشه n ام و توان گویا",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/cbw7634/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
},

{
  id: "video-riazi12-amoozeshabad-fasle3-darse3-1",
  title: "فصل سوم | درس 3 - تابع نمایی",
  html: `<style>.h_iframe-aparat_embed_frame{position:relative;}.h_iframe-aparat_embed_frame .ratio{display:block;width:100%;height:auto;}.h_iframe-aparat_embed_frame iframe{position:absolute;top:0;left:0;width:100%;height:100%;}</style><div class="h_iframe-aparat_embed_frame"><span style="display: block;padding-top: 57%"></span><iframe src="https://www.aparat.com/video/video/embed/videohash/mxri172/vt/frame?titleShow=true"  allowFullScreen="true" webkitallowfullscreen="true" mozallowfullscreen="true"></iframe></div>`
}
  ],
};

  
  /* ===== ارجاع به عناصر مودال ===== */
  const videoModal  = document.getElementById('videoModal');
  const videoTitle  = document.getElementById('videoTitle');
  const videoSelect = document.getElementById('videoSelect');
  const videoPlayer = document.getElementById('videoPlayer');
  const videoClose  = document.getElementById('videoClose');
  
  /* ===== باز/رندر/بستن مودال ===== */
  function openVideoModal(groupKey, titleText, idx = 0){
    const list = videoGroups[groupKey] || [];
    if (!list.length) return;
  
    videoTitle.textContent = titleText || 'پخش آنلاین';
    videoSelect.innerHTML = list.map((v,i)=>`<option value="${i}">${v.title}</option>`).join('');
    videoSelect.value = String(Math.max(0, Math.min(idx, list.length-1)));
    renderVideo(groupKey, parseInt(videoSelect.value,10));
  
    videoModal.style.display = 'flex';
    setTimeout(()=> videoModal.classList.add('show'), 10);
  }
  function renderVideo(groupKey, index){
    const list = videoGroups[groupKey] || [];
    const item = list[index];
    if (!item) return;
    videoPlayer.innerHTML = item.html; // پخش داخل پنجره
  }
  function closeVideoModal(){
    videoModal.classList.remove('show');
    setTimeout(()=>{
      videoModal.style.display='none';
      videoPlayer.innerHTML=''; // قطع پخش
    },160);
  }
  
  let currentVideoGroup = null;

function openVideoModal(groupKey, titleText, idx = 0){
  const list = videoGroups[groupKey] || [];
  if (!list.length) return;

  currentVideoGroup = groupKey; // ذخیره گروه فعال
  videoTitle.textContent = titleText || 'پخش آنلاین';
  videoSelect.innerHTML = list.map((v,i)=>`<option value="${i}">${v.title}</option>`).join('');
  videoSelect.value = String(Math.max(0, Math.min(idx, list.length-1)));
  renderVideo(groupKey, parseInt(videoSelect.value,10));

  videoModal.style.display = 'flex';
  setTimeout(()=> videoModal.classList.add('show'), 10);
}

videoSelect.addEventListener('change', ()=>{
  if (!currentVideoGroup) return;
  renderVideo(currentVideoGroup, parseInt(videoSelect.value,10));
});

  videoClose.addEventListener('click', closeVideoModal);
  videoModal.addEventListener('click', e=>{ if(e.target===videoModal) closeVideoModal(); });
  

  function wireVideoRow(rowId){
  const li = document.querySelector(`[data-id="${rowId}"]`);
  if (!li) return;
  const oldCard = li.querySelector('.book-card[data-video]');
  if (!oldCard) return;

  const card = oldCard.cloneNode(true);
  oldCard.replaceWith(card);

  const groupKey  = card.getAttribute('data-video') || '';
  const titleText = card.querySelector('.title')?.textContent?.trim() || 'پخش آنلاین';

  const open = (e)=>{ 
  e.preventDefault();
  e.stopPropagation();
  e.stopImmediatePropagation();
  openVideoModal(groupKey, titleText, 0);
};
// فقط روی دکمه‌ی View
const btn = card.querySelector('.icon-wrap.view');
if (btn) btn.addEventListener('click', open, false);

}
// باز کردن ویدیو با اولویت بالا (capture) تا هیچ handler دیگری اجرا نشود
document.addEventListener('click', function(e){
  const viewBtn = e.target.closest('.book-card[data-video] .icon-wrap.view');
  if (!viewBtn) return;

  e.preventDefault();
  e.stopPropagation();
  e.stopImmediatePropagation();

  const card = viewBtn.closest('.book-card[data-video]');
  const groupKey  = card?.dataset?.video || '';
  const titleText = card.querySelector('.title')?.textContent?.trim() || 'پخش آنلاین';
  if (groupKey) openVideoModal(groupKey, titleText, 0);
}, true); // ← حتماً capture = true

wireVideoRow('riazi10-videos');
wireVideoRow('riazi11-videos');
wireVideoRow('riazi12-videos');

  </script>
  
  
</body>
</html>
.
