<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©â€ŒØ¯Ø±Ø³ÛŒ ØªØ§Ø±ÛŒØ®</title>
  <style>
    /* ğŸ¨ ÙÙˆÙ†Øª Ø§ÛŒØ±Ø§Ù†â€ŒÛŒÚ©Ø§Ù† */
    @font-face {
      font-family: 'iranyekan';
      src: url('iranyekanweblight.woff') format('woff');
    }

    /* ğŸ¨ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ú©Ù„ÛŒ ØµÙØ­Ù‡ */
    body{
      font-family:'iranyekan',sans-serif;
      background-color:#222222;
      color:#fff;
      margin:0;
      padding:0;
      text-align:center;
    }

    /* ğŸŸ¢ Ù‡Ø¯Ø± */
    header{
      background-color:#1C93E3;
      color:#fff;
      padding:20px;
      font-size:22px;
      font-weight:bold;
    }

    /* ğŸ“š Ù„ÛŒØ³Øª Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ */
    .book-list{max-width:500px;margin:30px auto;padding:0;list-style:none}

    /* ğŸ”µ Ø¢ÛŒØªÙ…â€ŒÙ‡Ø§ */
    .book-item{
      background-color:#28A745;
      padding:15px;margin:10px 0;border-radius:8px;
      box-shadow:0 2px 5px rgba(0,0,0,.3);
      transition:transform .2s ease, box-shadow .2s ease;
    }
    .book-item:hover{transform:translateY(-3px);box-shadow:0 4px 12px rgba(0,0,0,.5)}
    .book-item a{text-decoration:none;color:#fff;font-weight:bold}

    /* ğŸ“± Ø±ÛŒØ³Ù¾Ø§Ù†Ø³ÛŒÙˆ */
    @media (max-width:500px){
      header{font-size:18px}
      .book-item{font-size:14px}
    }

    /* ğŸ“Š Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ */
    #counter{margin:30px 0;font-size:18px;color:#ccc}
  </style>
</head>
<body>

  <header>ğŸ“š Ú©ØªØ§Ø¨â€ŒÙ‡Ø§ÛŒ Ú©Ù…Ú©â€ŒØ¯Ø±Ø³ÛŒ ØªØ§Ø±ÛŒØ®</header>

  <ul class="book-list">
    <li class="book-item">
      <a href="https://mega.nz/file/tmgwVKRA#LkrI54ta-_8RQcato_aABuFHHhThghOvjQzWXjfPQ4k" target="_blank">
        Ù…Ø§Ø¬Ø±Ø§ÛŒ Ø¨ÛŒØ³Øª â€“ Ø®ÛŒÙ„ÛŒ Ø³Ø¨Ø²
      </a>
    </li>
    <li class="book-item">
      <a href="https://mega.nz/file/ViBikQ7C#a6qWI8LcF28a8FVpS8z1CZEt4yeVZAn2V1bkOzdCCFQ" target="_blank">
        Ù…Ø§Ø¬Ø±Ø§Ù‡Ø§ÛŒ Ù…Ù† Ùˆ Ø¯Ø±Ø³Ø§Ù… â€“ Ø®ÛŒÙ„ÛŒ Ø³Ø¨Ø²
      </a>
    </li>
    <li class="book-item">
      <a href="https://s34.picofile.com/file/8486137768/tarikh11_shab.pdf.html" target="_blank">
        Ø´Ø¨ Ø§Ù…ØªØ­Ø§Ù† â€“ Ø®ÛŒÙ„ÛŒ Ø³Ø¨Ø²
      </a>
    </li>
  </ul>

  <!-- ğŸ“Š Ù†Ù…Ø§ÛŒØ´ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¨Ø§Ø²Ø¯ÛŒØ¯ -->
  <div id="counter">
    <span id="visit-count">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</span>
  </div>

  <!-- ğŸ“Š Ø§Ø³Ú©Ø±ÛŒÙ¾Øª Ø¨Ø±Ø§ÛŒ Ø´Ù…Ø§Ø±Ø´ Ø¨Ø§Ø²Ø¯ÛŒØ¯ + Ø«Ø¨Øª Ù„Ø§Ú¯ -->
  <script>
    async function loadVisits() {
      const slug = (location.pathname.replace(/[^\w]+/g, '_') || 'index');

      try {
        // 1ï¸âƒ£ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡ Ø¨Ø§Ø²Ø¯ÛŒØ¯
        const res = await fetch(`/api/visits?slug=${encodeURIComponent(slug)}`, { cache: 'no-store' });
        const data = await res.json();

        if (!res.ok || typeof data.value !== 'number') {
          throw new Error('bad response');
        }

        document.getElementById('visit-count').textContent =
          `Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø§ÛŒÙ† ØµÙØ­Ù‡: ${data.value}`;

        // 2ï¸âƒ£ Ø«Ø¨Øª Ù„Ø§Ú¯ Ø¨Ø§Ø²Ø¯ÛŒØ¯
        await fetch("/api/log", { method: "POST" });

      } catch (e) {
        // ğŸ‘‡ Ø§Ú¯Ø± Ø³Ø±ÙˆØ± Ø¯Ø± Ø¯Ø³ØªØ±Ø³ Ù†Ø¨ÙˆØ¯ØŒ Ø´Ù…Ø§Ø±Ù†Ø¯Ù‡â€ŒÛŒ Ù„ÙˆÚ©Ø§Ù„
        const k = `local_visits_${slug}`;
        const n = (parseInt(localStorage.getItem(k) || '0', 10) + 1);
        localStorage.setItem(k, n);
        document.getElementById('visit-count').textContent =
          `Ø¨Ø§Ø²Ø¯ÛŒØ¯ Ø§ÛŒÙ† ØµÙØ­Ù‡ (Ù„ÙˆÚ©Ø§Ù„): ${n}`;
      }
    }
    loadVisits();
  </script>

</body>
</html>
